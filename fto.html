{% extends "base.html" %}
{% block title %}FTO{% endblock %}
{% block content %}

<script>
document.addEventListener("DOMContentLoaded", function () {
  const cells = document.querySelectorAll(".cell");
  let firstClickedCell = null;
  let secondClickedCell = null;

  cells.forEach((cell) => {
    cell.addEventListener("click", function () {
      if (!firstClickedCell) {
        firstClickedCell = cell;
        highlightCells(firstClickedCell);
      } else if (!secondClickedCell) {
        secondClickedCell = cell;
        applyColorChange(firstClickedCell, secondClickedCell);
        firstClickedCell = null;
        secondClickedCell = null;
        clearHighlighting();
      }
    });

    cell.addEventListener("mouseover", function () {
      if (firstClickedCell && !secondClickedCell) {
        highlightCells(cell);
      }
    });

    cell.addEventListener("mouseout", function () {
      if (!firstClickedCell || secondClickedCell) {
        clearHighlighting();
        if (firstClickedCell) {
          highlightCells(firstClickedCell);
        }
      }
    });
  });

  function highlightCells(targetCell) {
    const startIndex = Array.from(cells).indexOf(firstClickedCell);
    const endIndex = Array.from(cells).indexOf(targetCell);

    cells.forEach((cell, index) => {
      if (index >= Math.min(startIndex, endIndex) && index <= Math.max(startIndex, endIndex)) {
        const originalColor = cell.getAttribute("data-original");
        const highlightColorClass = originalColor === "red" ? "highlight-red" : "highlight-green";
        cell.classList.add(highlightColorClass);
      } else {
        cell.classList.remove("highlight-red", "highlight-green");
      }
    });
  }

  function applyColorChange(startCell, endCell) {
    const colorToApply = startCell.getAttribute("data-original") === "red" ? "green" : "red";
    const startIndex = Array.from(cells).indexOf(startCell);
    const endIndex = Array.from(cells).indexOf(endCell);

    cells.forEach((cell, index) => {
      if (index >= Math.min(startIndex, endIndex) && index <= Math.max(startIndex, endIndex)) {
        cell.classList.remove("red", "green", "highlight-red", "highlight-green");
        cell.classList.add(colorToApply);
        cell.setAttribute("data-original", colorToApply);
      }
    });
  }

  function clearHighlighting() {
    cells.forEach((cell) => {
      cell.classList.remove("highlight-red", "highlight-green");
    });
  }
});
</script>

<div class="col-md-2">
</div>

<div class="col-md-8"> <!-- center col -->

  <div class="row">

  <h2 class="page-header">HP Sand Volleyball {{ year }}</h2>

  </div> <!-- row -->

  <div class="row">

  <form class="form-horizontal" action="fto" method="post">
  <div class="col-sm-12">

    <!-- Committed -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <H4>{{ player.name }}'s Schedule Restrictions</H4>
      </div>
	  <div>
		<p>Please availability to play. Make sure the days you can play are highlighted green and the days you cannot play are highlighted red. The system will automatically add holidays and global conflicts to your calendar.</p>
		<p class="text-danger"><strong>The system will prioritize scheduling so that everyone plays as much as possible, but know that the more days you are available, the more likely you will be scheduled to play.</strong></p>
	  </div>
      <table class="table table-striped table-condensed">
        <tr>
            <td></td>
            <th><div style="vertical-align:middle; text-align:center">Mon @ 12</div></th>
            <th><div style="vertical-align:middle; text-align:center">Tue @ 12</div></th>
            <th><div style="vertical-align:middle; text-align:center">Wed @ 12</div></th>
            <th><div style="vertical-align:middle; text-align:center">Thu @ 12</div></th>
            <th><div style="vertical-align:middle; text-align:center">Fri @ 12</div></th>
        </tr>
        {% for week in weeks %}
        <tr>
            <th>Week {{ loop.index }} <small>({{ week }})</small></th>
            <td class="cell {% if fto_week[loop.index-1][0] %}red{% else %}green{% endif %}" data-week="{{ loop.index }}-1" data-original="{% if fto_week[loop.index-1][0] %}red{% else %}green{% endif %}"></td>
            <td class="cell {% if fto_week[loop.index-1][1] %}red{% else %}green{% endif %}" data-week="{{ loop.index }}-2" data-original="{% if fto_week[loop.index-1][1] %}red{% else %}green{% endif %}"></td>
            <td class="cell {% if fto_week[loop.index-1][2] %}red{% else %}green{% endif %}" data-week="{{ loop.index }}-3" data-original="{% if fto_week[loop.index-1][2] %}red{% else %}green{% endif %}"></td>
            <td class="cell {% if fto_week[loop.index-1][3] %}red{% else %}green{% endif %}" data-week="{{ loop.index }}-4" data-original="{% if fto_week[loop.index-1][3] %}red{% else %}green{% endif %}"></td>
            <td class="cell {% if fto_week[loop.index-1][4] %}red{% else %}green{% endif %}" data-week="{{ loop.index }}-5" data-original="{% if fto_week[loop.index-1][4] %}red{% else %}green{% endif %}"></td>
        </tr>
        {% endfor %}
       </table>{%
      if user %}{%
	  if player.id != user.user_id() %}
	  <input type="hidden" name="pid" value="{{player.id}}"></input>{%
	  endif %}{%
	  endif %}
      <button id="save" name="action" type="submit" class="btn btn-success btn-block" value="Save">
            <span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span> Save
      </button>
    </div>
  </div>

  </form>
  </div> <!-- row -->



</div> <!-- center col -->

<div class="col-md-2">
</div>

{% endblock %}